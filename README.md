# ðŸ“ˆ Stock Alert Trading System

A Python-based monitoring & alert system for Indian stock futures. It fetches OHLC data using Kite Connect, calculates ADX/DX & a custom CBOE-style indicator, and triggers alerts when specific conditions are met.

---

## Table of Contents

- [Features](#features)  
- [Prerequisites](#prerequisites)  
- [Setup & Installation](#setup--installation)  
- [Configuration](#configuration)  
- [Folder Structure](#folder-structure)  
- [How It Works](#how-it-works)  
  - Data ingestion  
  - Calculating ADX  
  - Calculating CBOE indicator  
  - Strategy & alert generation  
- [Running the System](#running-the-system)  
- [Alerts Output](#alerts-output)  
- [Troubleshooting](#troubleshooting)  
- [Extending & Customizing](#extending--customizing)

---

## Features

- Connects to Zerodhaâ€™s Kite Connect API to fetch daily and intraday futures data  
- Loads 50-day historical OHLC (+Volume) tables in PostgreSQL  
- Calculates ADX/DX using Wilderâ€™s method (PineScript-aligned)  
- Computes a custom CBOE-like indicator using RSI + weighted volume flow  
- Triggers alerts when indicator thresholds are met  
- Exports alerts in text format: one contract per line

---

## Prerequisites

- Python 3.9+  
- PostgreSQL  
- Kite Connect API credentials  
- Recommended: virtualenv or Conda environment  

---

## Setup & Installation

```bash
git clone https://github.com/priyanshupriyank04/Stock_alert_trading_system.git
cd Stock_alert_trading_system

python -m venv venv
source venv/bin/activate  # macOS/Linux
.\venv\Scripts\activate  # Windows

pip install -r requirements.txt

---

## Configuration

1. **Kite Connect API Setup**  
   - Obtain your `API_KEY` and `API_SECRET` from [Zerodha Kite Developer Console](https://developers.kite.trade/).  
   - Place them in `config.py` like this:

     ```python
     API_KEY = "your_api_key_here"
     API_SECRET = "your_api_secret_here"
     ```

   - Make sure your session is authenticated before running the scripts (the repo already handles token reuse automatically).

2. **PostgreSQL Setup**  
   - Ensure PostgreSQL is installed and running.  
   - Create a database for this project:
     ```bash
     createdb stock_alerts_db
     ```
   - Update your DB credentials in `config.py`:
     ```python
     DB_NAME = "stock_alerts_db"
     DB_USER = "your_username"
     DB_PASSWORD = "your_password"
     DB_HOST = "localhost"
     DB_PORT = 5432
     ```

3. **Market Holidays Configuration**  
   - The list of market holidays is already defined in `alert.py` as `MARKET_HOLIDAYS`.  
   - Update it each year as required.

---

## Folder Structure


---

## How It Works

### 1. Data Ingestion (update_ohlc.py)

- The script iterates over `current_month_futures` (populated from NSE contracts).  
- For each contract:
  - Pulls **last 50 trading days** of OHLC + volume data.
  - Builds a **synthetic daily candle for today** (if market is open and after 09:15 AM) using hourly candles.
  - Saves results into `ohlc_<symbol>` tables in PostgreSQL.
  - Tables are **truncated and rebuilt each time** to ensure clean history.

### 2. ADX Calculation (calc_adx.py)

- For each OHLC table:
  - Calculates **True Range, +DM, â€“DM, DI+, DIâ€“, DX, ADX** using **Wilderâ€™s smoothing (PineScript-matching)**.
  - Updates these columns in each futures table.
  - Uses `period=2` by default (can be modified in `calculate_adx_for_table`).

### 3. CBOE Indicator Calculation (calc_cboe.py)

- For each OHLC table:
  - Calculates:
    - **Primary RSI (14)**  
    - **Stochastic RSI (K, D)**  
    - **Secondary RSI-based oscillator (7-period)**  
    - **Weighted volume price flows** for market odds calculation (bullish, bearish, stagnant).
  - Populates:
    - `stoch_k`, `stoch_d`
    - `odd_bull`, `odd_bear`, `odd_stagnant`
  - Ensures DB table contains all required columns and commits results.

### 4. Strategy & Alert Generation (strategy_alert.py)

- Reads **last 2 rows** for each contract.
- Triggers an alert when:
  - **Bullish case:**  
    - `(odd_bull[-1] < 15 OR odd_bull[0] < 15)` AND  
    - `(di_plus[-1] < 9 OR di_plus[0] < 9)` AND  
    - `odd_bull[0] < 15 AND di_plus[0] < 9`
  - **Bearish case:**  
    - `(odd_bear[-1] < 15 OR odd_bear[0] < 15)` AND  
    - `(di_minus[-1] < 9 OR di_minus[0] < 9)` AND  
    - `odd_bear[0] < 15 AND di_minus[0] < 9`
- All triggered contracts are written into `alerts.csv` (one per line).

---

## Running the System

Run the scripts sequentially to fetch data, calculate indicators, and generate alerts:

```bash
# Step 1: Update OHLC + Volume for all futures
python scripts/update_ohlc.py

# Step 2: Calculate ADX for all futures
python scripts/calc_adx.py

# Step 3: Calculate CBOE indicators for all futures
python scripts/calc_cboe.py

# Step 4: Run strategy and generate alerts
python scripts/strategy_alert.py

---

## Alerts Output

- The alerts generated by the strategy are saved in the file `alerts.csv`.  
- Each matching contract is listed **on a new line**, like this:

ABCAPITAL25JULFUT
HDFCBANK25JULFUT
TATASTEEL25JULFUT


- The file is **overwritten on each run**, meaning only the **latest triggered contracts** are kept.

---

## Troubleshooting

1. **`volume` column missing errors**  
   - Run `update_ohlc.py` again.  
   - The script automatically creates the `volume` column for all `ohlc_<symbol>` tables if it doesnâ€™t exist.

2. **No alerts generated**  
   - Check the indicator thresholds (`15` for `odd_bull` / `odd_bear` and `9` for `di_plus` / `di_minus`).  
   - Validate the raw indicator values in the PostgreSQL tables to confirm the strategy logic is being met.

3. **Unsorted or inconsistent database tables**  
   - Data is sorted during ingestion and indicator calculation.  
   - If you manually modify the tables, run:
     ```sql
     CLUSTER ohlc_<symbol> USING idx_date_ohlc_<symbol>;
     ANALYZE ohlc_<symbol>;
     ```
   - Replace `<symbol>` with the specific futures contract name.

---

## Extending & Customizing

- **Change indicator periods:**  
  - Edit `calculate_adx_for_table(period=...)` for ADX.  
  - Edit `calculate_cboe_for_table(lengthRSI=..., lengthStoch=..., lengthcboe=...)` for CBOE oscillator.

- **Modify strategy thresholds:**  
  - Adjust the `15` and `9` thresholds inside `strategy_alert.py` as needed.

- **Add notification channels:**  
  - Extend `run_strategy_and_alert()` to send alerts via Email, Slack, or Telegram instead of (or in addition to) writing to `alerts.csv`.

- **Use for live alerts:**  
  - The scripts currently run in **batch mode**.  
  - To use live monitoring, schedule them with `cron` (Linux/macOS) or Task Scheduler (Windows).

---

## Summary of Core Functions

| Function                           | Purpose                                                                    |
|------------------------------------|----------------------------------------------------------------------------|
| `update_futures_ohlc()`            | Fetches last 50 trading days of OHLC + volume and builds synthetic daily candles. |
| `calculate_adx_for_table()`        | Calculates DI+, DIâˆ’, DX, and ADX for each futures table (PineScript-matched).      |
| `run_adx_for_all_futures()`        | Applies ADX calculation to all current month futures.                               |
| `calculate_cboe_for_table()`       | Calculates RSI-based Stochastic + Volume-weighted CBOE odds indicators.             |
| `run_cboe_for_all_futures()`       | Runs the CBOE calculation across all futures.                                         |
| `run_strategy_and_alert()`         | Evaluates strategy conditions and writes qualifying contracts to `alerts.csv`.        |

---



